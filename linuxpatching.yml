---
- hosts: all

  pre_tasks:

  - name: Install Katello RPM for Satellite Server
    yum:
      name: https://sat6.shadowman.dev/pub/katello-ca-consumer-latest.noarch.rpm
      state: present

  - name: Use Activation Key to Register to Satellite
    redhat_subscription:
      state: present
      activationkey: RHEL7 Everything
      org_id: Shadow_Man

  - name: Enable Repositories
    rhsm_repository:
      name: "{{ repos }}"
      purge: True
    vars:
      repos:
        - rhel-7-server-rpms
        - rhel-7-server-extras-rpms
        - rhel-7-server-optional-rpms
  roles:
    - ansible.ospatch